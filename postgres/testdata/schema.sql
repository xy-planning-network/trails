CREATE schema IF NOT EXISTS public;

CREATE TABLE IF NOT EXISTS accounts (
  id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  deleted_at timestamp with time zone,
  kind text NOT NULL DEFAULT 'default'
);

TRUNCATE TABLE accounts;

CREATE TABLE IF NOT EXISTS users (
  id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  deleted_at timestamp with time zone,
  account_id bigint NOT NULL,
  email text NOT NULL,
  name text NOT NULL,
  role text NOT NULL,

  CONSTRAINT fk_users_account_id FOREIGN KEY (account_id) REFERENCES accounts(id) ON UPDATE CASCADE ON DELETE CASCADE
);

TRUNCATE TABLE users;

CREATE TABLE IF NOT EXISTS logins (
  id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  at timestamp with time zone NOT NULL DEFAULT now(),
  user_id bigint NOT NULL,
  
  CONSTRAINT fk_logins_user_id FOREIGN KEY (user_id) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE
);

TRUNCATE TABLE logins;

CREATE TABLE IF NOT EXISTS groups (
  id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  deleted_at timestamp with time zone,
  title text NOT NULL
);

TRUNCATE TABLE groups;

CREATE TABLE IF NOT EXISTS user_groups (
  group_id bigint NOT NULL,
  user_id bigint NOT NULL,

  CONSTRAINT fk_user_groups_group_id FOREIGN KEY (group_id) REFERENCES groups(id) ON UPDATE CASCADE ON DELETE CASCADE,
  CONSTRAINT fk_user_groups_user_id FOREIGN KEY (user_id) REFERENCES users(id) ON UPDATE CASCADE ON DELETE CASCADE
);

TRUNCATE TABLE user_groups;
